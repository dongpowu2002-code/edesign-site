<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eDesign Labs | äº‘åŒæ­¥ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .user-active { border-color: #38bdf8; background-color: #0c4a6e; color: white; transform: scale(1.05); }
        /* åŠ è½½åŠ¨ç”» */
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #38bdf8; border-radius: 50%; width: 14px; height: 14px; animate: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex flex-col items-center py-8 px-4">

    <div class="max-w-md w-full space-y-6">
        <div class="flex justify-between items-center px-2">
            <span class="text-[10px] font-mono text-slate-500 uppercase">Cloud Sync Status:</span>
            <span id="sync-status" class="text-[10px] text-green-500 font-bold">â— ONLINE</span>
        </div>
        
        <div class="bg-slate-800 p-4 rounded-2xl border border-slate-700 shadow-lg">
            <div class="flex gap-3">
                <button id="btn-WDP" onclick="setUser('WDP')" class="flex-1 border-2 border-slate-700 py-2 rounded-xl transition-all font-bold">WDP</button>
                <button id="btn-YAJ" onclick="setUser('YAJ')" class="flex-1 border-2 border-slate-700 py-2 rounded-xl transition-all font-bold">YAJ</button>
                <button onclick="logout()" id="logout-btn" class="hidden bg-slate-700 px-3 py-2 rounded-xl text-slate-400 text-xs">ç™»å‡º</button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-slate-800 p-4 rounded-2xl text-center border border-slate-700 relative">
                <div class="text-3xl mb-1">â­</div>
                <div id="star-count" class="text-4xl font-bold text-red-500">...</div>
            </div>
            <div class="bg-slate-800 p-4 rounded-2xl text-center border border-slate-700 relative">
                <div class="text-3xl mb-1">ğŸ’£</div>
                <div id="bomb-count" class="text-4xl font-bold text-orange-500">...</div>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl opacity-50 pointer-events-none" id="control-panel">
            <div class="space-y-4">
                <input type="number" id="input-qty" value="1" min="1" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 outline-none text-xl font-bold">
                <input type="text" id="input-remark" placeholder="æ·»åŠ å¤‡æ³¨..." class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 outline-none text-sm">
                <div class="flex gap-4 pt-2">
                    <button id="btn-add-star" onclick="change('star', 1)" class="flex-1 bg-red-600 py-3 rounded-xl font-bold active:scale-95 transition">+ çº¢æ˜Ÿ</button>
                    <button id="btn-add-bomb" onclick="change('bomb', 1)" class="flex-1 bg-orange-600 py-3 rounded-xl font-bold active:scale-95 transition">+ ç‚¸å¼¹</button>
                </div>
            </div>
        </div>

        <div class="bg-slate-800 rounded-2xl p-6 h-80 flex flex-col border border-slate-700">
            <h3 class="text-slate-500 text-[10px] font-mono uppercase mb-4">Cloud Transaction Log</h3>
            <div id="log-container" class="overflow-y-auto space-y-3 flex-1 text-xs font-mono">
                <div class="text-slate-600 italic">æ­£åœ¨ä»äº‘ç«¯åŒæ­¥æ•°æ®...</div>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®ä½ çš„ä¸“å±äº‘ç«¯ IDï¼ˆè¯·ä¸è¦æ³„éœ²ç»™ä»–äººï¼‰
        const BUCKET_ID = "edesign_labs_v1_2026"; 
        const API_URL = `https://kvdb.io/6EExRsc8Q8gR9Gv1nS9T6q/data`; // è¿™æ˜¯ä¸€ä¸ªå…¬å…±æµ‹è¯•é€šé“

        let counts = { star: 0, bomb: 0 };
        let logs = [];
        let currentUser = null;

        // æ ¸å¿ƒï¼šä»äº‘ç«¯æ‹‰å–æ•°æ®
        async function loadFromCloud() {
            setSyncStatus('SYNCING...');
            try {
                const response = await fetch(API_URL);
                if (response.ok) {
                    const data = await response.json();
                    counts = data.counts || { star: 0, bomb: 0 };
                    logs = data.logs || [];
                }
            } catch (e) {
                console.log("åˆå§‹åŒ–äº‘ç«¯æ•°æ®...");
            }
            updateUI();
            renderLogs();
            setSyncStatus('ONLINE');
        }

        // æ ¸å¿ƒï¼šä¿å­˜åˆ°äº‘ç«¯
        async function saveToCloud() {
            setSyncStatus('SAVING...');
            try {
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ counts, logs })
                });
                setSyncStatus('ONLINE');
            } catch (e) {
                setSyncStatus('OFFLINE', true);
                alert("äº‘ç«¯ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ");
            }
        }

        function setSyncStatus(msg, isError = false) {
            const el = document.getElementById('sync-status');
            el.innerText = `â— ${msg}`;
            el.className = `text-[10px] font-bold ${isError ? 'text-red-500' : 'text-green-500'}`;
        }

        window.onload = loadFromCloud;

        function setUser(name) {
            currentUser = name;
            document.querySelectorAll('[id^="btn-"]').forEach(el => el.classList.remove('user-active'));
            document.getElementById(`btn-${name}`).classList.add('user-active');
            document.getElementById('control-panel').classList.remove('opacity-50', 'pointer-events-none');
            document.getElementById('logout-btn').classList.remove('hidden');
        }

        function logout() {
            currentUser = null;
            document.querySelectorAll('[id^="btn-"]').forEach(el => el.classList.remove('user-active'));
            document.getElementById('control-panel').classList.add('opacity-50', 'pointer-events-none');
            document.getElementById('logout-btn').classList.add('hidden');
        }

        async function change(type, direction) {
            if (!currentUser) return;
            
            const qty = parseInt(document.getElementById('input-qty').value) || 1;
            const remark = document.getElementById('input-remark').value || 'æ— å¤‡æ³¨';
            const totalDelta = qty * direction;

            if (counts[type] + totalDelta < 0) return alert("åº“å­˜ä¸è¶³ï¼");

            counts[type] += totalDelta;
            
            const time = new Date().toLocaleTimeString();
            const logHTML = `
                <div class="bg-slate-900/40 p-2 rounded border-l-2 ${direction > 0 ? 'border-sky-500' : 'border-slate-600'}">
                    <div class="flex justify-between text-slate-500 mb-1">
                        <span>[${time}] <b class="text-sky-400">${currentUser}</b></span>
                        <span class="font-bold">Total: ${counts[type]}</span>
                    </div>
                    <div>${direction > 0 ? 'æ–°å¢' : 'æ ¸å‡'} ${type === 'star' ? 'â­' : 'ğŸ’£'} x${qty} <span class="text-slate-500 ml-1">"${remark}"</span></div>
                </div>`;
            
            logs.unshift(logHTML);
            if (logs.length > 30) logs.pop();

            updateUI();
            renderLogs();
            document.getElementById('input-remark').value = '';
            
            // æ¯æ¬¡ä¿®æ”¹åï¼ŒåŒæ­¥åˆ°äº‘ç«¯
            await saveToCloud();
        }

        function updateUI() {
            document.getElementById('star-count').innerText = counts.star;
            document.getElementById('bomb-count').innerText = counts.bomb;
        }

        function renderLogs() {
            document.getElementById('log-container').innerHTML = logs.join('');
        }
    </script>
</body>
</html>
