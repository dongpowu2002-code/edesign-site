<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eDesign Labs | ä»»åŠ¡ç®¡ç†ç³»ç»Ÿ v5.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .user-active { border-color: #38bdf8; background-color: #0c4a6e; color: white; transform: scale(1.05); }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex flex-col items-center py-8 px-4">

    <div class="max-w-md w-full space-y-6">
        
        <div class="bg-slate-800 p-4 rounded-2xl border border-slate-700 shadow-lg">
            <div class="flex gap-3">
                <button id="btn-WDP" onclick="setUser('WDP')" class="flex-1 border-2 border-slate-700 py-2 rounded-xl transition-all font-bold">WDP</button>
                <button id="btn-YAJ" onclick="setUser('YAJ')" class="flex-1 border-2 border-slate-700 py-2 rounded-xl transition-all font-bold">YAJ</button>
                <button onclick="logout()" id="logout-btn" class="hidden bg-slate-700 px-3 py-2 rounded-xl text-slate-400 hover:text-white text-xs">ç™»å‡º</button>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-slate-800 p-4 rounded-2xl text-center border border-slate-700">
                <div class="text-3xl mb-1">â­</div>
                <div id="star-count" class="text-4xl font-bold text-red-500">0</div>
            </div>
            <div class="bg-slate-800 p-4 rounded-2xl text-center border border-slate-700">
                <div class="text-3xl mb-1">ğŸ’£</div>
                <div id="bomb-count" class="text-4xl font-bold text-orange-500">0</div>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl opacity-50 pointer-events-none transition-all" id="control-panel">
            <div class="space-y-4">
                <div>
                    <label class="text-xs text-slate-500 block mb-1 font-mono uppercase">Quantity / æ•°é‡</label>
                    <input type="number" id="input-qty" value="1" min="1" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-sky-500 outline-none text-xl font-bold">
                </div>
                <div>
                    <label class="text-xs text-slate-500 block mb-1 font-mono uppercase">Remark / å¤‡æ³¨</label>
                    <input type="text" id="input-remark" placeholder="è¾“å…¥æ·»åŠ ç†ç”±..." class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 focus:border-sky-500 outline-none">
                </div>
                <div class="flex gap-4 pt-2">
                    <button onclick="change('star', 1)" class="flex-1 bg-red-600 hover:bg-red-500 py-3 rounded-xl font-bold shadow-lg shadow-red-900/20 active:scale-95 transition">+ â­ çº¢æ˜Ÿ</button>
                    <button onclick="change('bomb', 1)" class="flex-1 bg-orange-600 hover:bg-orange-500 py-3 rounded-xl font-bold shadow-lg shadow-orange-900/20 active:scale-95 transition">+ ğŸ’£ ç‚¸å¼¹</button>
                </div>
                <div class="flex gap-4">
                    <button onclick="change('star', -1)" class="flex-1 border border-red-900/50 text-red-500 py-2 rounded-xl text-xs hover:bg-red-900/20">- å‡å°‘çº¢æ˜Ÿ</button>
                    <button onclick="change('bomb', -1)" class="flex-1 border border-orange-900/50 text-orange-500 py-2 rounded-xl text-xs hover:bg-orange-900/20">- å‡å°‘ç‚¸å¼¹</button>
                </div>
            </div>
        </div>

        <div class="bg-slate-800 rounded-2xl p-6 h-80 flex flex-col border border-slate-700">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-slate-500 text-[10px] font-mono uppercase tracking-[0.2em]">Transaction Log</h3>
                <button onclick="clearAll()" class="text-[10px] text-red-900 hover:text-red-500">æ¸…ç©ºæ•°æ®åº“</button>
            </div>
            <div id="log-container" class="overflow-y-auto space-y-3 flex-1 text-xs font-mono"></div>
        </div>
    </div>

    <script>
        let counts = JSON.parse(localStorage.getItem('edesign_counts')) || { star: 0, bomb: 0 };
        let logs = JSON.parse(localStorage.getItem('edesign_logs')) || [];
        let currentUser = null;

        window.onload = () => { updateUI(); renderLogs(); };

        function setUser(name) {
            currentUser = name;
            document.querySelectorAll('[id^="btn-"]').forEach(el => el.classList.remove('user-active'));
            document.getElementById(`btn-${name}`).classList.add('user-active');
            document.getElementById('control-panel').classList.remove('opacity-50', 'pointer-events-none');
            document.getElementById('logout-btn').classList.remove('hidden');
        }

        function logout() {
            currentUser = null;
            document.querySelectorAll('[id^="btn-"]').forEach(el => el.classList.remove('user-active'));
            document.getElementById('control-panel').classList.add('opacity-50', 'pointer-events-none');
            document.getElementById('logout-btn').classList.add('hidden');
        }

        function change(type, direction) {
            if (!currentUser) return;
            
            // è·å–ç”¨æˆ·è¾“å…¥çš„è‡ªå®šä¹‰æ•°é‡
            const qtyInput = document.getElementById('input-qty');
            const qty = parseInt(qtyInput.value) || 1;
            const remark = document.getElementById('input-remark').value || 'æ— å¤‡æ³¨';

            const totalDelta = qty * direction;

            // é€»è¾‘æ£€æŸ¥ï¼šä¸èƒ½å‡ä¸ºè´Ÿæ•°
            if (counts[type] + totalDelta < 0) {
                alert("åº“å­˜ä¸è¶³ï¼Œæ— æ³•æ‰£å‡ï¼");
                return;
            }

            counts[type] += totalDelta;
            
            // è®°å½•æ—¥å¿—
            const time = new Date().toLocaleTimeString();
            const action = direction > 0 ? "æ–°å¢" : "æ ¸å‡";
            const icon = type === 'star' ? "â­" : "ğŸ’£";
            
            const logHTML = `
                <div class="bg-slate-900/40 p-2 rounded border-l-2 ${direction > 0 ? 'border-sky-500' : 'border-slate-600'}">
                    <div class="flex justify-between text-slate-500 mb-1">
                        <span>[${time}] æ“ä½œäºº: <b class="text-sky-400">${currentUser}</b></span>
                        <span class="font-bold text-slate-300">æ€»è®¡: ${counts[type]}</span>
                    </div>
                    <div class="text-slate-200">
                        ${action} ${icon} x${qty} 
                        <span class="text-slate-500 ml-2 italic">"${remark}"</span>
                    </div>
                </div>`;
            
            logs.unshift(logHTML);
            if (logs.length > 50) logs.pop();

            // æ•°æ®æŒä¹…åŒ–
            localStorage.setItem('edesign_counts', JSON.stringify(counts));
            localStorage.setItem('edesign_logs', JSON.stringify(logs));

            // æ›´æ–° UI ä¸”æ¸…ç©ºå¤‡æ³¨æ ï¼Œæ•°é‡é‡ç½®ä¸º 1
            updateUI();
            renderLogs();
            document.getElementById('input-remark').value = '';
            document.getElementById('input-qty').value = '1';
        }

        function updateUI() {
            document.getElementById('star-count').innerText = counts.star;
            document.getElementById('bomb-count').innerText = counts.bomb;
        }

        function renderLogs() {
            document.getElementById('log-container').innerHTML = logs.join('');
        }

        function clearAll() {
            if (confirm("ç¡®å®šè¦å½»åº•æ¸…ç©ºæ•°æ®å—ï¼Ÿ")) {
                localStorage.clear();
                location.reload();
            }
        }
    </script>
</body>
</html>
