<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eDesign Labs | ‰ªªÂä°ËÆ∞ÂΩï‰ª™ v6.4</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .user-active { border-color: #38bdf8; background-color: #0c4a6e; color: white; box-shadow: 0 0 15px rgba(56,189,248,0.3); }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .syncing { animation: pulse 1s infinite; }
    </style>
</head>
<body class="bg-[#0f172a] text-slate-100 min-h-screen flex flex-col items-center py-6 px-4">

    <div class="max-w-md w-full space-y-5">
        <div id="status-bar" class="flex justify-between items-center px-4 py-2.5 bg-slate-800/80 rounded-2xl border border-slate-700 shadow-lg">
            <div class="flex items-center gap-2">
                <div id="sync-icon" class="w-2 h-2 rounded-full bg-slate-500"></div>
                <span id="sync-text" class="text-[10px] font-mono text-slate-400 uppercase tracking-tighter">Á≥ªÁªüÂáÜÂ§á‰∏≠</span>
            </div>
            <button onclick="loadFromCloud()" class="text-[9px] font-bold text-sky-400 bg-sky-400/10 px-2.5 py-1 rounded-lg">ÊâãÂä®ÂêåÊ≠•Êï∞ÊçÆ</button>
        </div>
        
        <div class="grid grid-cols-2 gap-3">
            <button id="btn-WDP" onclick="setUser('WDP')" class="bg-slate-800/50 border border-slate-700 py-3.5 rounded-2xl transition-all font-bold tracking-widest text-sm">WDP</button>
            <button id="btn-YAJ" onclick="setUser('YAJ')" class="bg-slate-800/50 border border-slate-700 py-3.5 rounded-2xl transition-all font-bold tracking-widest text-sm">YAJ</button>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-slate-800 p-5 rounded-3xl border border-slate-700 shadow-xl text-center">
                <div class="text-5xl font-black text-red-500 mb-1" id="star-count">0</div>
                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]">Stars ‚≠ê</div>
            </div>
            <div class="bg-slate-800 p-5 rounded-3xl border border-slate-700 shadow-xl text-center">
                <div class="text-5xl font-black text-orange-500 mb-1" id="bomb-count">0</div>
                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-[0.2em]">Bombs üí£</div>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-[2rem] border border-slate-700 shadow-2xl opacity-40 pointer-events-none transition-all duration-500" id="control-panel">
            <div class="space-y-4">
                <div class="flex gap-2">
                    <input type="number" id="input-qty" value="1" min="1" class="w-20 bg-slate-900 border border-slate-700 rounded-xl py-3 text-center text-sky-400 font-bold outline-none focus:border-sky-500">
                    <input type="text" id="input-remark" placeholder="Â§áÊ≥®ÁêÜÁî±..." class="flex-1 bg-slate-900 border border-slate-700 rounded-xl py-3 px-4 text-sm outline-none focus:border-sky-500">
                </div>
                <div class="grid grid-cols-1 gap-3">
                    <div class="flex gap-2">
                        <button onclick="change('star', -1)" class="w-14 bg-slate-700/50 text-red-500 py-4 rounded-xl font-black border border-red-900/20 active:bg-red-900/20">-</button>
                        <button onclick="change('star', 1)" class="flex-1 bg-red-600 hover:bg-red-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-red-900/30 active:scale-95 transition">Â¢ûÂä†Á∫¢Êòü ‚≠ê</button>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="change('bomb', -1)" class="w-14 bg-slate-700/50 text-orange-500 py-4 rounded-xl font-black border border-orange-900/20 active:bg-orange-900/20">-</button>
                        <button onclick="change('bomb', 1)" class="flex-1 bg-orange-600 hover:bg-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-900/30 active:scale-95 transition">Â¢ûÂä†ÁÇ∏Âºπ üí£</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-slate-800/50 rounded-2xl p-4 h-52 border border-slate-700 flex flex-col">
            <div id="log-container" class="overflow-y-auto space-y-2 flex-1 text-[11px] font-mono scrollbar-hide"></div>
        </div>
    </div>

    <script>
        // „ÄêÂÖ≥ÈîÆ„ÄëËØ∑‰øÆÊîπ‰∏ãÊñπ‰∏∫‰Ω†‰∏ìÂ±ûÁöÑ„ÄÅÈïø‰∏ÄÁÇπÁöÑÊöóÂè∑ÔºåÈò≤Ê≠¢ÂÜ≤Á™Å
        const MY_PRIVATE_KEY = "edesign_labs_personal_v64_unique"; 
        const API_URL = `https://kvdb.io/6EExRsc8Q8gR9Gv1nS9T6q/${MY_PRIVATE_KEY}`;

        let counts = { star: 0, bomb: 0 };
        let logs = [];
        let currentUser = null;

        // ÂêØÂä®ÈÄªËæëÔºöÂÖàËØªÊú¨Âú∞ÔºàÁßíÂºÄÔºâÔºåÂÜçÂêåÊ≠•‰∫ëÁ´ØÔºàÈùôÈªòÊõ¥Êñ∞Ôºâ
        window.onload = () => {
            const local = JSON.parse(localStorage.getItem(MY_PRIVATE_KEY));
            if (local) {
                counts = local.counts || counts;
                logs = local.logs || logs;
                updateUI();
                renderLogs();
                setSyncStatus('Â∑≤ËΩΩÂÖ•Êú¨Âú∞', 'yellow');
            }
            loadFromCloud();
        };

        async function loadFromCloud() {
            setSyncStatus('ÂêåÊ≠•‰∏≠...', 'blue', true);
            try {
                // ‰ΩøÁî®Â∏¶Ë∂ÖÊó∂ÁöÑ fetch Èò≤Ê≠¢Âç°Ê≠ª
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000);
                
                const res = await fetch(API_URL, { signal: controller.signal });
                clearTimeout(timeoutId);

                if (res.ok) {
                    const data = await res.json();
                    if (data && data.counts) {
                        counts = data.counts;
                        logs = data.logs || [];
                        saveToLocal();
                        updateUI();
                        renderLogs();
                        setSyncStatus('‰∫ëÁ´ØÂêåÊ≠•ÂÆåÊàê', 'green');
                        return;
                    }
                }
                setSyncStatus('‰∫ëÁ´ØÊöÇÊó†Êï∞ÊçÆ', 'orange');
            } catch (e) {
                setSyncStatus('ÂêåÊ≠•Â§±Ë¥•/Êú¨Âú∞Ê®°Âºè', 'orange');
            }
        }

        async function saveToCloud() {
            setSyncStatus('‰∏ä‰º†‰∏≠...', 'blue', true);
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ counts, logs, timestamp: Date.now() })
                });
                if (res.ok) {
                    setSyncStatus('ÂêåÊ≠•Â∑≤‰øùÂ≠ò', 'green');
                } else {
                    throw new Error();
                }
            } catch (e) {
                setSyncStatus('‰∏ä‰º†Â§±Ë¥•(Â∑≤Â≠òÊú¨Âú∞)', 'red');
            }
        }

        function saveToLocal() {
            localStorage.setItem(MY_PRIVATE_KEY, JSON.stringify({ counts, logs }));
        }

        function setSyncStatus(msg, color, isSyncing = false) {
            const dot = document.getElementById('sync-icon');
            const text = document.getElementById('sync-text');
            text.innerText = msg;
            text.className = `text-[10px] font-mono ${isSyncing ? 'syncing' : ''} text-slate-400`;
            const colors = { green: 'bg-green-500', blue: 'bg-sky-500', orange: 'bg-orange-500', yellow: 'bg-yellow-500', red: 'bg-red-500' };
            dot.className = `w-2 h-2 rounded-full ${colors[color]}`;
        }

        function setUser(name) {
            currentUser = name;
            document.querySelectorAll('[id^="btn-"]').forEach(el => el.classList.remove('user-active'));
            document.getElementById(`btn-${name}`).classList.add('user-active');
            document.getElementById('control-panel').classList.remove('opacity-40', 'pointer-events-none');
        }

        async function change(type, dir) {
            if (!currentUser) return;
            const qty = Math.max(1, parseInt(document.getElementById('input-qty').value) || 1);
            const remark = document.getElementById('input-remark').value || '-';
            const delta = qty * dir;

            if (counts[type] + delta < 0) return alert("Êï∞Èáè‰∏çË∂≥ÔºÅ");

            counts[type] += delta;
            
            const logEntry = `<div class="bg-slate-900/50 p-2 rounded border-l-2 ${dir > 0 ? 'border-sky-500' : 'border-slate-500'} flex justify-between items-center">
                <div>
                    <span class="text-slate-200">${dir > 0 ? 'Ôºã' : 'Ôºç'} ${type === 'star' ? '‚≠ê' : 'üí£'} ${qty}</span>
                    <span class="text-[8px] text-slate-500 block">${currentUser} | ${new Date().toLocaleTimeString()}</span>
                </div>
                <span class="text-slate-500 italic text-[9px]">"${remark}"</span>
            </div>`;
            
            logs.unshift(logEntry);
            if (logs.length > 25) logs.pop();

            updateUI();
            renderLogs();
            saveToLocal();
            await saveToCloud();
            document.getElementById('input-remark').value = '';
            document.getElementById('input-qty').value = '1';
        }

        function updateUI() {
            document.getElementById('star-count').innerText = counts.star;
            document.getElementById('bomb-count').innerText = counts.bomb;
        }

        function renderLogs() {
            document.getElementById('log-container').innerHTML = logs.join('');
        }
    </script>
</body>
</html>
