<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eDesign Labs | ‰ªªÂä°ËÆ∞ÂΩï‰ª™ v6.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .user-active { border-color: #38bdf8; background-color: #0c4a6e; color: white; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex flex-col items-center py-6 px-4">

    <div class="max-w-md w-full space-y-6">
        <div class="flex justify-between items-center px-3 py-2 bg-slate-800 rounded-xl border border-slate-700">
            <div class="flex items-center gap-2">
                <div id="sync-icon" class="w-2 h-2 rounded-full bg-slate-500"></div>
                <span id="sync-text" class="text-[10px] font-mono text-slate-400">Ê≠£Âú®Ê£ÄÊü•‰∫ëÁ´Ø...</span>
            </div>
            <button onclick="loadFromCloud()" class="text-[9px] bg-slate-700 px-2 py-1 rounded text-sky-400 font-bold uppercase">ÊâãÂä®Âà∑Êñ∞</button>
        </div>
        
        <div class="grid grid-cols-2 gap-3">
            <button id="btn-WDP" onclick="setUser('WDP')" class="bg-slate-800 border-2 border-slate-700 py-3 rounded-xl transition-all font-bold tracking-widest">WDP</button>
            <button id="btn-YAJ" onclick="setUser('YAJ')" class="bg-slate-800 border-2 border-slate-700 py-3 rounded-xl transition-all font-bold tracking-widest">YAJ</button>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-slate-800 p-5 rounded-2xl text-center border border-slate-700 shadow-xl">
                <div class="text-4xl font-black text-red-500 mb-1" id="star-count">0</div>
                <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Stars ‚≠ê</div>
            </div>
            <div class="bg-slate-800 p-5 rounded-2xl text-center border border-slate-700 shadow-xl">
                <div class="text-4xl font-black text-orange-500 mb-1" id="bomb-count">0</div>
                <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Bombs üí£</div>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-2xl opacity-40 pointer-events-none transition-all" id="control-panel">
            <div class="space-y-4">
                <div class="flex gap-2">
                    <input type="number" id="input-qty" value="1" min="1" class="w-20 bg-slate-900 border border-slate-700 rounded-xl py-3 text-center text-sky-400 font-bold outline-none">
                    <input type="text" id="input-remark" placeholder="Â§áÊ≥®..." class="flex-1 bg-slate-900 border border-slate-700 rounded-xl py-3 px-4 text-sm outline-none">
                </div>
                <div class="flex gap-2">
                    <button onclick="change('star', -1)" class="w-14 bg-slate-700 text-red-500 py-4 rounded-xl font-black border border-red-900/20">-</button>
                    <button onclick="change('star', 1)" class="flex-1 bg-red-600 hover:bg-red-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-red-900/40">Â¢ûÂä†Á∫¢Êòü ‚≠ê</button>
                </div>
                <div class="flex gap-2">
                    <button onclick="change('bomb', -1)" class="w-14 bg-slate-700 text-orange-500 py-4 rounded-xl font-black border border-orange-900/20">-</button>
                    <button onclick="change('bomb', 1)" class="flex-1 bg-orange-600 hover:bg-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-900/40">Â¢ûÂä†ÁÇ∏Âºπ üí£</button>
                </div>
            </div>
        </div>

        <div class="bg-slate-800 rounded-2xl p-4 h-60 border border-slate-700 flex flex-col">
            <div id="log-container" class="overflow-y-auto space-y-2 flex-1 text-[11px] font-mono"></div>
        </div>
    </div>

    <script>
        /** ÈáçË¶ÅÔºöËØ∑Â∞Ü‰∏ãÊñπ‰øÆÊîπ‰∏∫‰Ω†‰∏ìÂ±ûÁöÑÂêçÂ≠óÔºåÈò≤Ê≠¢ÂíåÂà´‰∫∫Êï∞ÊçÆÊ∑∑Ê∑Ü **/
        const MY_PRIVATE_KEY = "edesign_labs_personal_777"; 
        const API_URL = `https://kvdb.io/6EExRsc8Q8gR9Gv1nS9T6q/${MY_PRIVATE_KEY}`;

        let counts = { star: 0, bomb: 0 };
        let logs = [];
        let currentUser = null;

        // Âä†ËΩΩÈ°∫Â∫èÔºöÂÖàÊú¨Âú∞ÔºåÂÜçË°•‰∫ëÁ´Ø
        window.onload = () => {
            const local = JSON.parse(localStorage.getItem(MY_PRIVATE_KEY));
            if (local) {
                counts = local.counts || counts;
                logs = local.logs || logs;
                updateUI();
                renderLogs();
            }
            loadFromCloud();
        };

        async function loadFromCloud() {
            setSyncStatus('Ê≠£Âú®ÂêåÊ≠•...', 'blue');
            try {
                const res = await fetch(API_URL);
                if (res.ok) {
                    const data = await res.json();
                    if (data && data.counts) {
                        counts = data.counts;
                        logs = data.logs || [];
                        saveToLocal();
                        updateUI();
                        renderLogs();
                        setSyncStatus('‰∫ëÁ´ØÂ∑≤ÂêåÊ≠•', 'green');
                        return;
                    }
                }
                setSyncStatus('‰∫ëÁ´Ø‰∏∫Á©∫ÊàñËøûÊé•‰∏≠', 'orange');
            } catch (e) {
                setSyncStatus('Êú¨Âú∞Ê®°Âºè', 'orange');
            }
        }

        async function saveToCloud() {
            setSyncStatus('Ê≠£Âú®‰∏ä‰º†...', 'blue');
            try {
                // ÂÖ≥ÈîÆÁÇπÔºöÂøÖÈ°ªÊ∑ªÂä† headersÔºåÂê¶Âàô API ÂèØËÉΩÊó†Ê≥ïËØÜÂà´Êï∞ÊçÆÊ†ºÂºè
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ counts, logs })
                });
                if (res.ok) setSyncStatus('‰∫ëÁ´ØÂ∑≤‰øùÂ≠ò', 'green');
                else throw new Error();
            } catch (e) {
                setSyncStatus('‰∏ä‰º†Â§±Ë¥•', 'red');
            }
        }

        function saveToLocal() {
            localStorage.setItem(MY_PRIVATE_KEY, JSON.stringify({ counts, logs }));
        }

        function setSyncStatus(msg, color) {
            const dot = document.getElementById('sync-icon');
            const text = document.getElementById('sync-text');
            text.innerText = msg;
            const colors = { green: 'bg-green-500', blue: 'bg-sky-500', orange: 'bg-orange-500', red: 'bg-red-500' };
            dot.className = `w-2 h-2 rounded-full ${colors[color]}`;
        }

        function setUser(name) {
            currentUser = name;
            document.querySelectorAll('[id^="btn-"]').forEach(el => el.classList.remove('user-active'));
            document.getElementById(`btn-${name}`).classList.add('user-active');
            document.getElementById('control-panel').classList.remove('opacity-40', 'pointer-events-none');
        }

        async function change(type, dir) {
            if (!currentUser) return;
            const qty = Math.max(1, parseInt(document.getElementById('input-qty').value) || 1);
            const remark = document.getElementById('input-remark').value || '-';
            const delta = qty * dir;

            if (counts[type] + delta < 0) return alert("Êï∞Èáè‰∏çË∂≥ÔºÅ");

            counts[type] += delta;
            
            const logEntry = `<div class="bg-slate-900/50 p-2 rounded border-l-2 ${dir > 0 ? 'border-sky-500' : 'border-slate-500'}">
                <div class="flex justify-between items-center">
                    <span>${dir > 0 ? 'Ôºã' : 'Ôºç'} ${type === 'star' ? '‚≠ê' : 'üí£'} ${qty}</span>
                    <span class="text-slate-500 text-[9px] uppercase">${currentUser} | ${new Date().toLocaleTimeString()}</span>
                </div>
            </div>`;
            
            logs.unshift(logEntry);
            if (logs.length > 30) logs.pop();

            updateUI();
            renderLogs();
            saveToLocal();
            await saveToCloud();
        }

        function updateUI() {
            document.getElementById('star-count').innerText = counts.star;
            document.getElementById('bomb-count').innerText = counts.bomb;
        }

        function renderLogs() {
            document.getElementById('log-container').innerHTML = logs.join('');
        }
    </script>
</body>
</html>
