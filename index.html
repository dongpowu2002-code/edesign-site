<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eDesign Labs | ä»»åŠ¡è®°å½•ä»ª v6.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .user-active { border-color: #38bdf8; background-color: #0c4a6e; color: white; box-shadow: 0 0 15px rgba(56, 189, 248, 0.4); }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen flex flex-col items-center py-6 px-4">

    <div class="max-w-md w-full space-y-6">
        <div class="flex justify-between items-center px-3 py-2 bg-slate-800/80 rounded-xl border border-slate-700">
            <div class="flex items-center gap-2">
                <div id="sync-icon" class="w-2 h-2 rounded-full bg-yellow-500"></div>
                <span id="sync-text" class="text-[10px] font-mono text-slate-400 uppercase">æ­£åœ¨åˆå§‹åŒ–...</span>
            </div>
            <span id="last-update" class="text-[9px] text-slate-500 font-mono"></span>
        </div>
        
        <div class="grid grid-cols-2 gap-3">
            <button id="btn-WDP" onclick="setUser('WDP')" class="bg-slate-800 border-2 border-slate-700 py-3 rounded-xl transition-all font-bold tracking-widest hover:border-sky-500">WDP</button>
            <button id="btn-YAJ" onclick="setUser('YAJ')" class="bg-slate-800 border-2 border-slate-700 py-3 rounded-xl transition-all font-bold tracking-widest hover:border-sky-500">YAJ</button>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <div class="bg-slate-800 p-5 rounded-2xl text-center border border-slate-700 shadow-2xl">
                <div class="text-4xl font-black text-red-500 mb-1" id="star-count">0</div>
                <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Stars â­</div>
            </div>
            <div class="bg-slate-800 p-5 rounded-2xl text-center border border-slate-700 shadow-2xl">
                <div class="text-4xl font-black text-orange-500 mb-1" id="bomb-count">0</div>
                <div class="text-[10px] text-slate-500 uppercase font-bold tracking-widest">Bombs ğŸ’£</div>
            </div>
        </div>

        <div class="bg-slate-800 p-6 rounded-3xl border border-slate-700 shadow-xl opacity-40 pointer-events-none transition-all duration-500" id="control-panel">
            <div class="space-y-5">
                <div class="grid grid-cols-3 gap-3">
                    <div class="col-span-1">
                        <label class="text-[10px] text-slate-500 block mb-1 px-1">æ•°é‡</label>
                        <input type="number" id="input-qty" value="1" min="1" class="w-full bg-slate-900 border border-slate-700 rounded-xl py-3 text-center text-sky-400 font-bold outline-none focus:border-sky-500">
                    </div>
                    <div class="col-span-2">
                        <label class="text-[10px] text-slate-500 block mb-1 px-1">å¤‡æ³¨/ç†ç”±</label>
                        <input type="text" id="input-remark" placeholder="å¯é€‰..." class="w-full bg-slate-900 border border-slate-700 rounded-xl py-3 px-4 text-sm outline-none focus:border-sky-500">
                    </div>
                </div>

                <div class="flex gap-3">
                    <button onclick="change('star', -1)" class="w-16 bg-slate-700 hover:bg-red-900/40 text-red-500 py-4 rounded-xl font-black text-xl transition-colors border border-red-900/20">-</button>
                    <button onclick="change('star', 1)" class="flex-1 bg-red-600 hover:bg-red-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-red-900/40 transition-transform active:scale-95 text-sm">å¢åŠ çº¢æ˜Ÿ â­</button>
                </div>

                <div class="flex gap-3">
                    <button onclick="change('bomb', -1)" class="w-16 bg-slate-700 hover:bg-orange-900/40 text-orange-500 py-4 rounded-xl font-black text-xl transition-colors border border-orange-900/20">-</button>
                    <button onclick="change('bomb', 1)" class="flex-1 bg-orange-600 hover:bg-orange-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-orange-900/40 transition-transform active:scale-95 text-sm">éƒ¨ç½²ç‚¸å¼¹ ğŸ’£</button>
                </div>
            </div>
        </div>

        <div class="bg-slate-800 rounded-2xl p-4 h-64 border border-slate-700 flex flex-col">
            <div class="flex justify-between items-center mb-3">
                <span class="text-[10px] font-mono text-slate-500 uppercase tracking-tighter">Event Logs</span>
                <button onclick="clearData()" class="text-[9px] text-red-900 hover:text-red-600 font-bold uppercase">Reset System</button>
            </div>
            <div id="log-container" class="overflow-y-auto space-y-2 flex-1 scrollbar-hide"></div>
        </div>
    </div>

    <script>
        // ä¸ºäº†é˜²æ­¢æ•°æ®å†²çªï¼Œå»ºè®®ä¿®æ”¹è¿™ä¸ª Key åå­—ï¼ˆæ¯”å¦‚åŠ ä½ çš„åå­—ç¼©å†™ï¼‰
        const STORAGE_KEY = "edesign_labs_v62_pro"; 
        const API_URL = `https://kvdb.io/6EExRsc8Q8gR9Gv1nS9T6q/${STORAGE_KEY}`;

        let counts = { star: 0, bomb: 0 };
        let logs = [];
        let currentUser = null;

        // 1. åˆå§‹åŒ–ï¼šåŠ è½½é¡ºåºéå¸¸é‡è¦
        window.onload = async () => {
            // ç¬¬ä¸€æ­¥ï¼šç«‹åˆ»ä»æœ¬åœ°è¯»ï¼Œä¿è¯åˆ·æ–°ä¸æ˜¾ç¤º 0
            const localData = localStorage.getItem(STORAGE_KEY);
            if (localData) {
                const parsed = JSON.parse(localData);
                counts = parsed.counts || counts;
                logs = parsed.logs || logs;
                updateUI();
                renderLogs();
                setSyncStatus('Local Loaded', 'yellow');
            }
            
            // ç¬¬äºŒæ­¥ï¼šåå°å»äº‘ç«¯æ‹¿æœ€æ–°çš„
            await loadFromCloud();
        };

        async function loadFromCloud() {
            try {
                const res = await fetch(API_URL);
                if (res.ok) {
                    const data = await res.json();
                    if (data && data.counts) {
                        counts = data.counts;
                        logs = data.logs || [];
                        saveToLocal();
                        updateUI();
                        renderLogs();
                        setSyncStatus('Cloud Synced', 'green');
                        document.getElementById('last-update').innerText = `Last Sync: ${new Date().toLocaleTimeString()}`;
                    }
                }
            } catch (e) {
                setSyncStatus('Offline Mode', 'orange');
            }
        }

        async function saveToCloud() {
            setSyncStatus('Saving...', 'blue');
            try {
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify({ counts, logs })
                });
                setSyncStatus('Cloud Synced', 'green');
            } catch (e) {
                setSyncStatus('Save to Local Only', 'orange');
            }
        }

        function saveToLocal() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify({ counts, logs }));
        }

        function setSyncStatus(msg, color) {
            const dot = document.getElementById('sync-icon');
            const text = document.getElementById('sync-text');
            text.innerText = msg;
            const colors = { green: 'bg-green-500', blue: 'bg-sky-500', orange: 'bg-orange-500', yellow: 'bg-yellow-500', red: 'bg-red-500' };
            dot.className = `w-2 h-2 rounded-full ${colors[color]}`;
        }

        function setUser(name) {
            currentUser = name;
            document.querySelectorAll('[id^="btn-"]').forEach(el => el.classList.remove('user-active'));
            document.getElementById(`btn-${name}`).classList.add('user-active');
            document.getElementById('control-panel').classList.remove('opacity-40', 'pointer-events-none');
        }

        async function change(type, direction) {
            if (!currentUser) return;
            const qty = Math.max(1, parseInt(document.getElementById('input-qty').value) || 1);
            const remark = document.getElementById('input-remark').value || '-';
            const delta = qty * direction;

            if (counts[type] + delta < 0) return alert("æ•°é‡ä¸è¶³ï¼");

            counts[type] += delta;
            
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const entry = `<div class="bg-slate-900/50 p-2 rounded-lg border-l-2 ${direction > 0 ? 'border-sky-500' : 'border-slate-600'} flex justify-between items-center">
                <div class="flex flex-col">
                    <span class="text-slate-200">${direction > 0 ? 'ï¼‹' : 'ï¼'} ${type === 'star' ? 'â­' : 'ğŸ’£'} ${qty} <span class="text-slate-500 ml-1 text-[9px]">"${remark}"</span></span>
                    <span class="text-[8px] text-slate-500">${time} BY ${currentUser}</span>
                </div>
                <div class="font-mono font-bold text-slate-400">#${counts[type]}</div>
            </div>`;
            
            logs.unshift(entry);
            if (logs.length > 40) logs.pop();

            updateUI();
            renderLogs();
            saveToLocal(); // ç¬æ—¶ä¿å­˜åˆ°æœ¬åœ°
            await saveToCloud(); // å¼‚æ­¥æ¨é€åˆ°äº‘ç«¯
            
            // é‡ç½®è¾“å…¥
            document.getElementById('input-remark').value = '';
            document.getElementById('input-qty').value = '1';
        }

        function updateUI() {
            document.getElementById('star-count').innerText = counts.star;
            document.getElementById('bomb-count').innerText = counts.bomb;
        }

        function renderLogs() {
            document.getElementById('log-container').innerHTML = logs.join('');
        }

        function clearData() {
            if(confirm("å°†æ¸…é™¤äº‘ç«¯å’Œæœ¬åœ°æ‰€æœ‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ")) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }
    </script>
</body>
</html>
